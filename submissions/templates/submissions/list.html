{% extends 'submissions/base.html' %}

{% block content %}
<div class="row mb-3 align-items-center">
    <div class="col">
        <h2 class="text-dark fw-bold">
            <i class="fa-solid fa-list-check me-2"></i>My Submissions
        </h2>
    </div>
    <div class="col-auto">
        <a href="." class="btn btn-outline-primary btn-sm shadow-sm">
            <i class="fa-solid fa-rotate-right"></i> Refresh List
        </a>
    </div>
</div>

<div class="card shadow border-0 overflow-hidden">
    <div class="card-body p-0">
        <table class="table table-hover mb-0 align-middle">
            <thead class="bg-light text-secondary">
                <tr>
                    <th class="ps-4">Submitted At</th>
                    <th>Language</th>
                    <th>Status</th>
                    <th>Output Result</th>
                    <th>Runtime</th>
                    <th class="text-end pe-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for sub in submissions %}
                <tr>
                    <td class="ps-4 text-muted code-font small">
                        {{ sub.created_at|date:"M d, H:i:s" }}
                    </td>

                    <td>
                        <span class="badge bg-light text-dark border">
                            {{ sub.language_id|title }}
                        </span>
                    </td>
                    
                    <td>
                        {% if sub.status == 'P' %}
                            <span class="badge bg-warning text-dark status-badge">
                                <i class="fa-solid fa-hourglass-start"></i> Pending
                            </span>
                        
                        {% elif sub.status == 'PR' %}
                            <span class="badge bg-info text-dark status-badge">
                                <i class="fa-solid fa-gears fa-spin"></i> Processing
                            </span>
                        
                        {% elif sub.status == 'C' %}
                            {% if sub.result == 'Accepted' or sub.result == 'Ran Successfully' %}
                                <span class="badge bg-success status-badge">
                                    <i class="fa-solid fa-check"></i> Success
                                </span>
                            {% else %}
                                <span class="badge bg-danger status-badge">
                                    <i class="fa-solid fa-triangle-exclamation"></i> Failed
                                </span>
                            {% endif %}
                        
                        {% else %}
                            <span class="badge bg-secondary status-badge">System Error</span>
                        {% endif %}
                    </td>
                    
                    <td>
                        <span class="code-font fw-bold text-dark small">
                            {{ sub.result|default:"-" }}
                        </span>
                    </td>
                    
                   <td class="small text-muted">
                        {% if sub.execution_time %}
                            <div class="d-flex flex-column gap-1">
                                <span class="code-font text-primary">
                                    <i class="fa-regular fa-clock me-1"></i> {{ sub.execution_time }}s
                                </span>
                                <span class="code-font text-secondary">
                                    <i class="fa-solid fa-file-code me-1"></i> {{ sub.memory_used }} B
                                </span>
                            </div>
                        {% else %}
                            <span class="text-secondary">-</span>
                        {% endif %}
                    </td>
                    
                    <td class="text-end pe-4">
                        <div class="d-flex justify-content-end gap-2">
                            <a href="{% url 'detail' sub.pk %}" class="btn btn-sm btn-outline-dark" title="View Details">
                                <i class="fa-solid fa-eye"></i>
                            </a>

                            <form action="{% url 'delete' sub.pk %}" method="post" onsubmit="return confirm('Are you sure you want to delete this submission? This cannot be undone.');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-5">
                        <div class="text-muted mb-3">
                            <i class="fa-solid fa-box-open fa-3x opacity-25"></i>
                        </div>
                        <h5 class="text-muted">No submissions yet</h5>
                        <p class="small text-secondary">Go ahead and write some code!</p>
                        <a href="{% url 'create' %}" class="btn btn-primary btn-sm mt-2">
                            + Start Coding
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% if submissions %}
<script>
    // document.addEventListener("DOMContentLoaded", function() {
    //     if (document.body.innerHTML.includes("Processing")) {
    //         setTimeout(function(){
    //            location.reload();
    //         }, 4000);
    //     }
    // });
</script>
{% endif %}
{% endblock %}